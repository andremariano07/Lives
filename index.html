<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Painel de Lives</title>

<style>
  :root{
    --bg:#111;
    --panel:#000;
    --accent:#00bfff;
    --text:#fff;
    --muted:#bbb;
    --border:#222;
    --radius:12px;
  }

  body { margin:0; background:var(--bg); font-family:Arial, sans-serif; color:var(--text); }

  #topbar{
    display:flex; justify-content:space-between; align-items:center;
    padding:10px 14px; border-bottom:1px solid var(--border); gap:12px;
  }
  #leftTop { display:flex; align-items:center; gap:10px; min-width:0; }
  #status { color:var(--muted); font-size:14px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  #clock{ color:var(--accent); font-size:22px; font-weight:bold; white-space:nowrap; }

  .btn{
    background:var(--accent);
    color:#000;
    border:none;
    border-radius:10px;
    padding:7px 10px;
    font-weight:800;
    cursor:pointer;
    white-space:nowrap;
  }
  .btn.secondary{
    background:#1f1f1f;
    color:var(--text);
    border:1px solid #2b2b2b;
    font-weight:700;
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
    padding:12px;
    height: calc(100vh - 58px);
    box-sizing:border-box;
  }

  .panel{
    border:2px solid var(--accent);
    border-radius:var(--radius);
    overflow:hidden;
    background:var(--panel);
    display:flex;
    flex-direction:column;
    min-height: 0;
  }

  .title{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    background:var(--accent);
    color:#000;
    font-weight:bold;
    padding:8px 10px;
  }

  .title .name{
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    flex:1;
  }

  .titleRight{
    display:flex;
    align-items:center;
    gap:8px;
    flex-shrink:0;
  }

  /* pill do viewers */
  .pill{
    background: rgba(0,0,0,0.25);
    padding:6px 10px;
    border-radius:999px;
    font-weight:900;
    white-space:nowrap;
    min-width: 90px;
    text-align:center;
  }

  /* botÃ£o de chat (agora com texto branco) */
  .miniBtn{
    background: rgba(0,0,0,0.35);
    border:1px solid rgba(0,0,0,0.20);
    color:#fff;
    padding:6px 10px;
    border-radius:999px;
    cursor:pointer;
    font-weight:900;
    white-space:nowrap;
  }

  .content{
    display:grid;
    grid-template-columns: 2fr 1fr; /* vÃ­deo maior, chat menor */
    flex:1;
    min-height:0;
  }

  iframe{ width:100%; height:100%; border:0; }

  /* esconder chat por painel */
  .chat-hidden .content{ grid-template-columns: 1fr; }
  .chat-hidden iframe.chat{ display:none; }

  /* ===== Modal ===== */
  .modalOverlay{
    position:fixed;
    inset:0;
    background: rgba(0,0,0,0.65);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px;
    z-index:9999;
  }
  .modal{
    width:min(720px, 100%);
    background:#0b0b0b;
    border:1px solid #2a2a2a;
    border-radius:18px;
    box-shadow: 0 16px 50px rgba(0,0,0,0.6);
    overflow:hidden;
  }
  .modalHeader{
    padding:14px 16px;
    background: #0f0f0f;
    border-bottom:1px solid #222;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }
  .modalHeader h2{
    margin:0;
    font-size:16px;
    color:#fff;
  }
  .modalBody{
    padding:16px;
    display:grid;
    gap:12px;
  }
  .field label{
    display:block;
    font-size:13px;
    color:#cfcfcf;
    margin-bottom:6px;
  }
  .field input{
    width:100%;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid #2a2a2a;
    background:#141414;
    color:#fff;
    box-sizing:border-box;
    outline:none;
  }
  .hint{
    color:#9c9c9c;
    font-size:12px;
    line-height:1.35;
  }
  .modalFooter{
    padding:14px 16px;
    border-top:1px solid #222;
    display:flex;
    justify-content:flex-end;
    gap:10px;
  }

  /* mobile */
  @media (max-width: 900px){
    .grid{ grid-template-columns: 1fr; height:auto; min-height: calc(100vh - 58px); }
    .panel{ min-height: 60vh; }
  }
</style>
</head>

<body>
  <div id="topbar">
    <div id="leftTop">
      <button class="btn secondary" id="editLinksBtn" type="button">Editar links</button>
      <div id="status">Carregandoâ€¦</div>
    </div>
    <div id="clock">00:00:00</div>
  </div>

  <div class="grid">
    <!-- LIVE 1 -->
    <div class="panel" id="panel1">
      <div class="title">
        <div class="name" id="t1">LIVE 1</div>
        <div class="titleRight">
          <div class="pill" id="v1">ðŸ‘€ â€”</div>
          <button class="miniBtn" id="toggleChat1" type="button">Ocultar chat</button>
        </div>
      </div>
      <div class="content">
        <iframe id="vid1" allowfullscreen></iframe>
        <iframe id="chat1" class="chat"></iframe>
      </div>
    </div>

    <!-- LIVE 2 -->
    <div class="panel" id="panel2">
      <div class="title">
        <div class="name" id="t2">LIVE 2</div>
        <div class="titleRight">
          <div class="pill" id="v2">ðŸ‘€ â€”</div>
          <button class="miniBtn" id="toggleChat2" type="button">Ocultar chat</button>
        </div>
      </div>
      <div class="content">
        <iframe id="vid2" allowfullscreen></iframe>
        <iframe id="chat2" class="chat"></iframe>
      </div>
    </div>
  </div>

  <!-- Modal (popup) -->
  <div class="modalOverlay" id="modalOverlay" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHeader">
        <h2 id="modalTitle">Configurar lives</h2>
        <button class="btn secondary" id="closeModalBtn" type="button">Fechar</button>
      </div>

      <div class="modalBody">
        <div class="field">
          <label for="liveUrl1">Link da Live 1 (YouTube)</label>
          <input id="liveUrl1" placeholder="https://www.youtube.com/watch?v=..." />
        </div>

        <div class="field">
          <label for="liveUrl2">Link da Live 2 (YouTube)</label>
          <input id="liveUrl2" placeholder="https://www.youtube.com/watch?v=..." />
        </div>

        <div class="hint">
          Dica: cole link de <b>watch?v=</b> ou <b>youtu.be/</b>. Os links ficam salvos neste navegador (localStorage).
        </div>
      </div>

      <div class="modalFooter">
        <button class="btn secondary" id="clearSavedBtn" type="button">Limpar salvos</button>
        <button class="btn" id="saveLinksBtn" type="button">Salvar e carregar</button>
      </div>
    </div>
  </div>

<script>
  // =========================
  // CONFIG
  // =========================
  const YOUTUBE_API_KEY = "AIzaSyBH9rhx0JLh1fwhBSxPsi0L1QoTmZa0OKU"; // <-- Cole SUA key aqui no seu arquivo
  const EMBED_DOMAIN = "andremariano07.github.io";
  const REFRESH_EVERY_MS = 15000;
  const LS_KEY = "painelLives.links.v1";

  // =========================
  // RELÃ“GIO
  // =========================
  function updateClock(){
    const now = new Date();
    const h = String(now.getHours()).padStart(2,'0');
    const m = String(now.getMinutes()).padStart(2,'0');
    const s = String(now.getSeconds()).padStart(2,'0');
    document.getElementById('clock').innerText = `${h}:${m}:${s}`;
  }
  setInterval(updateClock, 1000); updateClock();

  // =========================
  // UTIL: extrair ID do YouTube
  // =========================
  function extractYouTubeId(input){
    if(!input) return null;
    const s = input.trim();

    if(/^[a-zA-Z0-9_-]{11}$/.test(s)) return s;

    try{
      const u = new URL(s);
      const v = u.searchParams.get("v");
      if(v && /^[a-zA-Z0-9_-]{11}$/.test(v)) return v;

      if(u.hostname.includes("youtu.be")){
        const id = u.pathname.replace("/","").split("/")[0];
        if(/^[a-zA-Z0-9_-]{11}$/.test(id)) return id;
      }

      const parts = u.pathname.split("/").filter(Boolean);
      if(parts.length >= 2 && ["live","embed","shorts"].includes(parts[0])){
        const id = parts[1];
        if(/^[a-zA-Z0-9_-]{11}$/.test(id)) return id;
      }
    }catch(e){}
    return null;
  }

  // =========================
  // MODAL
  // =========================
  const modalOverlay = document.getElementById("modalOverlay");
  const liveUrl1Input = document.getElementById("liveUrl1");
  const liveUrl2Input = document.getElementById("liveUrl2");

  function saveLinks(url1, url2){
    localStorage.setItem(LS_KEY, JSON.stringify({ url1, url2 }));
  }
  function loadSavedLinks(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return null;
      return JSON.parse(raw);
    }catch(e){
      return null;
    }
  }
  function clearSavedLinks(){ localStorage.removeItem(LS_KEY); }

  function openModal(){
    const saved = loadSavedLinks();
    if(saved){
      liveUrl1Input.value = saved.url1 || "";
      liveUrl2Input.value = saved.url2 || "";
    }
    modalOverlay.style.display = "flex";
    setTimeout(()=> liveUrl1Input.focus(), 50);
  }
  function closeModal(){ modalOverlay.style.display = "none"; }

  document.getElementById("editLinksBtn").addEventListener("click", openModal);
  document.getElementById("closeModalBtn").addEventListener("click", closeModal);
  modalOverlay.addEventListener("click", (e)=>{ if(e.target === modalOverlay) closeModal(); });

  document.getElementById("clearSavedBtn").addEventListener("click", ()=>{
    clearSavedLinks();
    liveUrl1Input.value = "";
    liveUrl2Input.value = "";
  });

  // =========================
  // CHAT TOGGLE (um por live)
  // =========================
  function setChatHidden(panelEl, btnEl, hidden){
    panelEl.classList.toggle("chat-hidden", hidden);
    btnEl.textContent = hidden ? "Mostrar chat" : "Ocultar chat";
    btnEl.setAttribute("aria-pressed", hidden ? "true" : "false");
  }

  const panel1 = document.getElementById("panel1");
  const panel2 = document.getElementById("panel2");
  const toggleChat1 = document.getElementById("toggleChat1");
  const toggleChat2 = document.getElementById("toggleChat2");

  setChatHidden(panel1, toggleChat1, false);
  setChatHidden(panel2, toggleChat2, false);

  toggleChat1.addEventListener("click", ()=>{
    setChatHidden(panel1, toggleChat1, !panel1.classList.contains("chat-hidden"));
  });
  toggleChat2.addEventListener("click", ()=>{
    setChatHidden(panel2, toggleChat2, !panel2.classList.contains("chat-hidden"));
  });

  // =========================
  // IFRAMES / IDs dinÃ¢micos
  // =========================
  let VIDEO_1 = "N0lqE1yAduE";
  let VIDEO_2 = "w2wQeZ1L1Mo";

  function setVideoIds(id1, id2){
    VIDEO_1 = id1;
    VIDEO_2 = id2;

    document.getElementById("vid1").src = `https://www.youtube.com/embed/${VIDEO_1}`;
    document.getElementById("vid2").src = `https://www.youtube.com/embed/${VIDEO_2}`;

    document.getElementById("chat1").src = `https://www.youtube.com/live_chat?v=${VIDEO_1}&embed_domain=${EMBED_DOMAIN}`;
    document.getElementById("chat2").src = `https://www.youtube.com/live_chat?v=${VIDEO_2}&embed_domain=${EMBED_DOMAIN}`;
  }

  document.getElementById("saveLinksBtn").addEventListener("click", ()=>{
    const url1 = liveUrl1Input.value.trim();
    const url2 = liveUrl2Input.value.trim();

    const id1 = extractYouTubeId(url1);
    const id2 = extractYouTubeId(url2);

    if(!id1 || !id2){
      alert("Cole links vÃ¡lidos do YouTube para as duas lives (ou o ID do vÃ­deo com 11 caracteres).");
      return;
    }

    saveLinks(url1, url2);
    setVideoIds(id1, id2);
    closeModal();
    refreshAll();
  });

  // =========================
  // TÃTULO AUTOMÃTICO (oEmbed)
  // =========================
  async function fetchTitle(videoId){
    const url = `https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`;
    const res = await fetch(url);
    if(!res.ok) throw new Error("Falha ao buscar tÃ­tulo (oEmbed).");
    const data = await res.json();
    return data.title || "Sem tÃ­tulo";
  }

  // =========================
  // VIEWERS AO VIVO (YouTube Data API) - CORRIGIDO
  // =========================
  async function fetchConcurrentViewers(videoId){
    if(!YOUTUBE_API_KEY || YOUTUBE_API_KEY.trim() === "" || YOUTUBE_API_KEY === "AIzaSyBH9rhx0JLh1fwhBSxPsi0L1QoTmZa0OKU") return null;

    const url =
      `https://www.googleapis.com/youtube/v3/videos` +
      `?part=liveStreamingDetails&id=${videoId}&key=${encodeURIComponent(YOUTUBE_API_KEY)}`;

    const res = await fetch(url);

    if(!res.ok){
      let detail = "";
      try{
        const err = await res.json();
        detail = err?.error?.message ? ` | ${err.error.message}` : "";
      }catch(e){}
      throw new Error(`API HTTP ${res.status}${detail}`);
    }

    const data = await res.json();
    const item = data.items && data.items[0];
    const viewers = item?.liveStreamingDetails?.concurrentViewers;

    return viewers ? Number(viewers) : 0; // se nÃ£o estiver ao vivo -> 0
  }

  function formatViewers(n){
    if (n === null) return "ðŸ‘€ â€”";
    return `ðŸ‘€ ${Number(n).toLocaleString("pt-BR")}`;
  }

  async function refreshAll(){
    const status = document.getElementById("status");
    try{
      status.innerText = "Atualizando tÃ­tulos e viewersâ€¦";

      const [title1, title2] = await Promise.all([
        fetchTitle(VIDEO_1),
        fetchTitle(VIDEO_2)
      ]);
      document.getElementById("t1").innerText = title1;
      document.getElementById("t2").innerText = title2;

      const [v1, v2] = await Promise.all([
        fetchConcurrentViewers(VIDEO_1),
        fetchConcurrentViewers(VIDEO_2)
      ]);
      document.getElementById("v1").innerText = formatViewers(v1);
      document.getElementById("v2").innerText = formatViewers(v2);

      if(v1 === null || v2 === null){
        status.innerText = "TÃ­tulos OK. Cole sua API key para mostrar viewers ao vivo.";
      } else {
        status.innerText = "Atualizado âœ…";
      }
    }catch(e){
      status.innerText = `Erro: ${e.message}`;
    }
  }

  // =========================
  // INIT
  // =========================
  const saved = loadSavedLinks();
  if(saved && saved.url1 && saved.url2){
    const id1 = extractYouTubeId(saved.url1);
    const id2 = extractYouTubeId(saved.url2);
    if(id1 && id2){
      setVideoIds(id1, id2);
      refreshAll();
      setInterval(refreshAll, REFRESH_EVERY_MS);
    }else{
      openModal();
    }
  }else{
    openModal();
  }
</script>
</body>
</html>
